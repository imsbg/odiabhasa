<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!--
      ================================================================
      ENGLISH SEO & BROWSER METADATA
      ================================================================
    -->
    <title>Odia Bhasa App | ଓଡ଼ିଆ ଭାଷା</title>
    <meta name="description" content="The complete app to learn and master the Odia (ଓଡ଼ିଆ) language. Study the alphabet, numbers, conjunct characters, and read classic literature like Madhu Barnabodha.">
    <meta name="keywords" content="learn odia, odia language app, odia alphabet, odia barnabodha, odia lipi, oriya language, Odia Bhasa App, Odia Bhasa Application, Learn Odia, Sandeep Biswal G, ଓଡ଼ିଆ ଭାଷା, ଓଡ଼ିଆ ବର୍ଣ୍ଣବୋଧ, ଓଡ଼ିଆ ଶିଖିବା">
    <meta name="author" content="Sandeep Biswal G">
    <meta name="theme-color" content="#c80000">

    <!--
      ================================================================
      SOCIAL MEDIA META TAGS (Open Graph & Twitter)
      (These are defaults. open.js on the server will overwrite these dynamically)
      ================================================================
    -->
    <meta property="og:title" content="Odia Bhasa - The Complete Odia Learning App">
    <meta property="og:description" content="Learn Odia letters, numbers, and read classic literature. Click to open or install the app.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://odiabhasa.pages.dev/open">
    <meta property="og:site_name" content="Odia Bhasa App">
    <meta property="og:locale" content="en_US">
    
    <meta property="og:image" content="https://imsbg.github.io/odiabhasa/images/app.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Odia Bhasa - The Complete Odia Learning App">
    <meta name="twitter:description" content="Learn Odia letters, numbers, and read classic literature. Click to open or install the app.">
    <meta name="twitter:image" content="https://imsbg.github.io/odiabhasa/images/app.png">

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="https://imsbg.github.io/odiabhasa/images/app.png">
    <link rel="apple-touch-icon" href="https://imsbg.github.io/odiabhasa/images/app.png">

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Noto Sans Oriya', sans-serif;
            background-color: #f5f7fa;
            color: #1d1d1d;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            padding: 40px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        
        /* Image Styling */
        .app-logo, .book-cover {
            margin-bottom: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            object-fit: cover;
        }
        .app-logo {
            width: 80px;
            height: 80px;
            border-radius: 20%;
        }
        .book-cover {
            width: 140px; 
            height: auto;
            aspect-ratio: 2/3; /* Standard book ratio */
        }

        h1 {
            font-weight: 700;
            font-size: 26px;
            margin-bottom: 8px;
            margin-top: 0;
            color: #c80000;
        }
        h2 {
            font-size: 16px;
            color: #666;
            margin-top: 0;
            margin-bottom: 25px;
            font-weight: normal;
        }
        p {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
        }

        /* Loader */
        .loader {
            border: 4px solid #e0e0e0;
            border-top: 4px solid #c80000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 25px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Buttons */
        .action-area {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        .btn {
            display: inline-block;
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 15px;
            transition: background 0.2s;
            width: 80%;
            max-width: 300px;
        }
        .btn-primary {
            background-color: #c80000;
            color: white;
            border: none;
        }
        .btn-primary:hover {
            background-color: #a00000;
        }
        .btn-secondary {
            background-color: #fff;
            color: #c80000;
            border: 2px solid #c80000;
        }
        .btn-secondary:hover {
            background-color: #fff0f0;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <!-- Dynamic Image: Defaults to App Logo, changes to Book Cover if Bahi is present -->
        <img id="main-image" src="https://imsbg.github.io/odiabhasa/images/app.png" alt="Odia Bhasa" class="app-logo">
        
        <!-- Dynamic Titles -->
        <h1 id="page-title">ଓଡ଼ିଆ ଭାଷା ଆପ୍</h1>
        <h2 id="page-subtitle">ଆମ ଭାଷା, ଆମ ପରିଚୟ</h2>
        
        <div id="loading-section">
            <p id="status-text">ଆପ୍ ରେ କଣ୍ଟେଣ୍ଟ ଖୋଲିବାକୁ ଚେଷ୍ଟା କରାଯାଉଛି...</p>
            <div class="loader"></div>
        </div>

        <!-- Buttons Section (Shows on PC or if App fails) -->
        <div id="manual-actions" class="action-area hidden">
            <!-- Button for PC Users to read on Web -->
            <a id="web-read-link" href="#" class="btn btn-secondary hidden">ୱେବସାଇଟ୍ ରେ ପଢ଼ନ୍ତୁ</a>
            
            <!-- Button to Install App -->
            <a id="store-link" href="#" class="btn btn-primary">ଆପ୍ ଇନଷ୍ଟଲ୍ କରନ୍ତୁ (Play Store)</a>
        </div>
    </div>

    <script>
      (function() {
        // --- CONFIGURATION ---
        const PLAY_STORE_URL = 'https://play.google.com/store/apps/details?id=in.sandeep.odiabhasa';
        
        // **IMPORTANT**: Change this to the actual URL where users read books on your site.
        // For example: 'https://odiabhasa.pages.dev/read.html?book='
        // Since I don't have your reader page, I am pointing to the JSON for now, or you can point to a PDF viewer.
        // If you don't have a web reader yet, leave it empty or point to a coming soon page.
        const WEB_READER_BASE_URL = 'https://odiabhasa.pages.dev/read?book='; 

        const titleMap = {
            "Swara": "ସ୍ଵରବର୍ଣ୍ଣ",
            "Byanjana": "ବ୍ୟଞ୍ଜନବର୍ଣ୍ଣ",
            "Sankhya": "୧ ରୁ ୧୦୦ ପର୍ଯ୍ୟନ୍ତ ସଂଖ୍ୟା",
            "Yukta": "ଯୁକ୍ତାକ୍ଷର",
            "Barna_Parichaya": "ବର୍ଣ୍ଣ ପରିଚୟ",
            "Matra": "ମାତ୍ରା",
            "Phala": "ଫଳା",
            "Bahi": "ଓଡ଼ିଆ ବହି",
            "Book_Reader": "ବହି ପଢିବା",
            "Menu": "ମେନୁ",
            "About": "ଆପ୍ ବିଷୟରେ",
            "History_Odisha": "ଓଡ଼ିଶାର ଇତିହାସ",
            "History_Lang": "ଓଡ଼ିଆ ଭାଷାର ଇତିହାସ",
            "Lipyantara": "ଲିପ୍ୟନ୍ତର",
            "Odia_Calendar": "ଓଡ଼ିଆ କ୍ୟାଲେଣ୍ଡର",
            "Madhu_Barnabodha": "ଛବିଳ ମଧୁ ବର୍ଣ୍ଣବୋଧ",
            "Writing": "ଓଡ଼ିଆ ଅକ୍ଷର ଲେଖି ଶିଖନ୍ତୁ"
        };

        // --- UTILS ---
        const params = new URLSearchParams(window.location.search);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        const ui = {
            img: document.getElementById('main-image'),
            title: document.getElementById('page-title'),
            subtitle: document.getElementById('page-subtitle'),
            status: document.getElementById('status-text'),
            loader: document.getElementById('loading-section'),
            actions: document.getElementById('manual-actions'),
            webBtn: document.getElementById('web-read-link'),
            storeBtn: document.getElementById('store-link')
        };

        // --- STEP 1: RESOLVE CONTENT (Book or Category) ---
        let contentId = null;

        if (params.has('Bahi')) {
            // == BOOK LOGIC ==
            contentId = params.get('Bahi');
            const jsonUrl = `https://sbgb.pages.dev/ବହି/ଖାତା/${contentId}.json`;

            // Fetch Book Data for UI
            fetch(jsonUrl)
                .then(res => res.json())
                .then(data => {
                    ui.title.textContent = data.title;
                    ui.subtitle.textContent = "ଲେଖକ: " + data.author;
                    
                    if (data.coverpage) {
                        ui.img.src = data.coverpage;
                        ui.img.className = "book-cover"; // Change style to rectangular book
                    }
                    document.title = data.title + " | ଓଡ଼ିଆ ଭାଷା";
                })
                .catch(err => {
                    console.error("Error fetching book:", err);
                    ui.title.textContent = "ଓଡ଼ିଆ ବହି";
                });
                
            // Set up Web Reader Link for PC users
            ui.webBtn.href = WEB_READER_BASE_URL + contentId;
            // If you want to link directly to the JSON for now as a fallback:
            // ui.webBtn.href = jsonUrl; 

        } else {
            // == STATIC CATEGORY LOGIC ==
            let key = window.location.search.substring(1).split('=')[0];
            if (titleMap[key]) {
                ui.title.textContent = titleMap[key];
                contentId = key;
            }
        }

        // --- STEP 2: HANDLE REDIRECTION ---
        ui.storeBtn.href = PLAY_STORE_URL;
        const customSchemeUrl = 'odiabhasa://open' + window.location.search;

        if (isMobile) {
            // ** MOBILE FLOW **
            // Attempt to open app
            window.location.href = customSchemeUrl;

            // Fallback to Play Store if app doesn't open within 2.5s
            const fallbackTimeout = setTimeout(function() {
                ui.loader.classList.add('hidden'); // Hide loader
                ui.actions.classList.remove('hidden'); // Show manual buttons
                window.location.href = PLAY_STORE_URL;
            }, 2500);

            // Cancel redirect if user leaves page (app opened successfully)
            function onVisibilityChange() {
                if (document.hidden || document.webkitHidden) {
                    clearTimeout(fallbackTimeout);
                }
            }
            document.addEventListener('visibilitychange', onVisibilityChange, false);
            window.addEventListener('pagehide', () => clearTimeout(fallbackTimeout), false);

        } else {
            // ** PC / DESKTOP FLOW **
            ui.status.textContent = "ଓଡ଼ିଆ ଭାଷା ଆପ୍ କୁ ସ୍ୱାଗତ";
            ui.loader.classList.add('hidden');
            ui.actions.classList.remove('hidden');
            
            // Only show "Read on Web" button if it is a Book
            if (params.has('Bahi')) {
                ui.webBtn.classList.remove('hidden');
                ui.webBtn.textContent = "ୱେବସାଇଟ୍ ରେ ପଢ଼ନ୍ତୁ"; 
            } else {
                // For static categories, we might not have a web view yet
                ui.webBtn.classList.add('hidden'); 
            }
        }

      })();
    </script>
</body>
</html>
