<!DOCTYPE html>
<html lang="or">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & METADATA -->
    <title>Odia Bhasa App | ଓଡ଼ିଆ ଭାଷା</title>
    <meta name="description" content="The complete app to learn and master the Odia language.">
    <meta name="keywords" content="learn odia, odia language app, odia alphabet, odia barnabodha">
    <meta name="author" content="Sandeep Biswal G">
    <meta name="theme-color" content="#ffffff">

    <!-- OPEN GRAPH -->
    <meta property="og:title" content="Odia Bhasa - The Complete Odia Learning App">
    <meta property="og:description" content="Learn Odia letters, numbers, and read classic literature.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://odiabhasa.pages.dev/open">
    <meta property="og:image" content="https://imsbg.github.io/odiabhasa/images/app.png">
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,opsz,wght@0,17..18,400..700;1,17..18,400..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        /* --- GLOBAL VARIABLES --- */
        :root {
            --font-main: 'Google Sans', sans-serif;
            --font-odia: 'Noto Sans Oriya', sans-serif;
            --primary-red: #d32f2f;
            --bg-home: #ffffff;
            --bg-card-mode: #eef2f5;
        }

        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: #202124;
            background-color: var(--bg-home); /* Default to Home BG */
        }

        body.card-mode {
            background: linear-gradient(135deg, #eef2f5 0%, #e6e9f0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* UTILS */
        .hidden { display: none !important; }
        a { text-decoration: none; color: inherit; }

        /* =========================================
           VIEW 1: HOME UI (App Like)
           ========================================= */
        #view-home {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            background: #fff;
        }

        .home-header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(5px);
            padding: 15px 20px;
            display: flex; align-items: center;
        }
        .home-title { font-family: var(--font-odia); font-weight: 700; font-size: 24px; margin-left: 12px; }

        .home-body { padding: 10px 20px 40px 20px; display: flex; flex-direction: column; gap: 20px; }

        .banner-img { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 16px; background: #eee; }

        .section-title { font-family: var(--font-odia); font-weight: 700; font-size: 20px; margin: 10px 0 15px 0; }
        
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .cat-card { background: #F5F7FA; border-radius: 20px; padding: 15px 10px; text-align: center; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: transform 0.1s; }
        .cat-card:active { transform: scale(0.98); }
        .cat-circle { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font-odia); font-weight: 700; font-size: 20px; margin-bottom: 10px; }
        .cat-label { font-family: var(--font-odia); font-size: 13px; font-weight: 600; }

        .num-strip { background: #E0F7FA; border-radius: 20px; padding: 20px; display: flex; align-items: center; overflow: hidden; white-space: nowrap; cursor: pointer; }
        .num-label { font-family: var(--font-odia); font-size: 24px; font-weight: 700; color: #006064; margin-right: 15px; }
        .num-text { font-family: var(--font-odia); font-size: 24px; color: #006064; letter-spacing: 15px; opacity: 0.8; }

        .ui-card { width: 100%; border-radius: 20px; padding: 20px; display: flex; align-items: center; box-sizing: border-box; color: white; margin-bottom: 15px; cursor: pointer; }
        .ui-card.orange { background: linear-gradient(to right, #FF9800, #FF5722); box-shadow: 0 8px 20px rgba(255, 87, 34, 0.3); }
        .ui-card.purple { background: linear-gradient(to right, #7226FF, #4362FF); box-shadow: 0 8px 20px rgba(67, 98, 255, 0.3); }
        .ui-card.white { background: #fff; color: #000; border: 1px solid #f0f0f0; margin-bottom: 0; }
        
        .card-icon { font-size: 32px; margin-right: 15px; }
        .card-content { flex: 1; }
        .card-h { font-family: var(--font-odia); font-size: 18px; font-weight: 700; display: block; }
        .card-s { font-family: var(--font-odia); font-size: 13px; opacity: 0.9; display: block; }

        /* =========================================
           VIEW 2: CARD UI (Deep Link / Ama Gouraba)
           ========================================= */
        #view-card {
            background: #fff;
            width: 100%; max-width: 420px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            position: relative; overflow: hidden;
            padding: 40px 30px;
            box-sizing: border-box;
            text-align: center;
            display: flex; flex-direction: column; align-items: center;
        }
        #view-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background-color: var(--primary-red); }

        #main-image { width: 140px; height: auto; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); object-fit: contain; margin-bottom: 24px; }
        
        #page-title { font-family: var(--font-odia); font-size: 24px; font-weight: 700; margin: 0 0 8px 0; line-height: 1.3; }
        #page-subtitle { font-family: var(--font-odia); font-size: 14px; color: #5f6368; margin: 0 0 30px 0; }

        .spinner { width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid var(--primary-red); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .action-btn { display: flex; align-items: center; justify-content: center; width: 100%; padding: 14px; border-radius: 12px; font-family: var(--font-odia); font-weight: 700; font-size: 15px; gap: 10px; margin-bottom: 12px; }
        .btn-red { background: linear-gradient(180deg, #d32f2f 0%, #c62828 100%); color: white; border: none; box-shadow: 0 4px 12px rgba(211, 47, 47, 0.25); }
        .btn-white { background: white; color: #202124; border: 1px solid #e0e0e0; }
        
        .footer { margin-top: 24px; font-size: 12px; color: #9aa0a6; text-align: center; }

    </style>
</head>
<body>

    <!-- 
      ================================================================
      VIEW 1: HOME UI (Shown if URL has NO parameters)
      ================================================================
    -->
    <div id="view-home">
        <header class="home-header">
            <span class="material-symbols-rounded">menu</span>
            <span class="home-title">ଓଡ଼ିଆ ଭାଷା</span>
        </header>

        <div class="home-body">
            <img src="https://imsbg.github.io/Odia-Bhasa-App-Photos/img/bnvp2.png" class="banner-img" alt="Banner">

            <!-- Category Grid (Links add query params to trigger View 2) -->
            <div>
                <div class="section-title">ବିଭାଗ</div>
                <div class="cat-grid">
                    <a href="?Swara" class="cat-card"><div class="cat-circle" style="background:#FFF0F0;">ଅ</div><div class="cat-label">ସ୍ୱରବର୍ଣ୍ଣ</div></a>
                    <a href="?Byanjana" class="cat-card"><div class="cat-circle" style="background:#F0F8FF;">କ</div><div class="cat-label">ବ୍ୟଞ୍ଜନବର୍ଣ୍ଣ</div></a>
                    <a href="?Barna_Parichaya" class="cat-card"><div class="cat-circle" style="background:#F0FFF4;">ବର୍ଣ୍ଣ</div><div class="cat-label">ବର୍ଣ୍ଣ ପରିଚୟ</div></a>
                    <a href="?Matra" class="cat-card"><div class="cat-circle" style="background:#FFF8E1;">ା</div><div class="cat-label">ମାତ୍ରା</div></a>
                    <a href="?Phala" class="cat-card"><div class="cat-circle" style="background:#F3E5F5;">୍ୟ</div><div class="cat-label">ଫଳା</div></a>
                    <a href="?Yukta" class="cat-card"><div class="cat-circle" style="background:#E8EAF6;">ଙ୍କ</div><div class="cat-label">ଯୁକ୍ତାକ୍ଷର</div></a>
                </div>
            </div>

            <a href="?Sankhya" class="num-strip">
                <div class="num-label">ସଂଖ୍ୟା :</div>
                <div class="num-text">୦ ୧ ୨ ୩ ୪ ୫ ୬ ୭</div>
            </a>

            <div style="display:flex; flex-direction:column;">
                <a href="?Writing" class="ui-card orange">
                    <span class="material-symbols-rounded card-icon">edit</span>
                    <div class="card-content">
                        <span class="card-h">ଅକ୍ଷର ଲେଖି ଶିଖନ୍ତୁ</span>
                        <span class="card-s">ଅକ୍ଷର ଉପରେ ଲେଖନ୍ତୁ</span>
                    </div>
                    <span class="material-symbols-rounded">chevron_right</span>
                </a>

                <a href="?Madhu_Barnabodha" class="ui-card purple">
                    <span class="material-symbols-rounded card-icon">menu_book</span>
                    <div class="card-content">
                        <span class="card-h">ଛବିଳ ମଧୁ ବର୍ଣ୍ଣବୋଧ</span>
                        <span class="card-s">ପଢିବା ପାଇଁ କ୍ଲିକ୍ କରନ୍ତୁ</span>
                    </div>
                    <span class="material-symbols-rounded">chevron_right</span>
                </a>

                <a href="?Odia_Calendar" class="ui-card white">
                    <span class="material-symbols-rounded card-icon" style="color:#1976D2">calendar_month</span>
                    <div class="card-content">
                        <span class="card-h">କ୍ୟାଲେଣ୍ଡର</span>
                        <span class="card-s">ପର୍ବପର୍ବାଣି ଓ ଛୁଟିଦିନ ଦେଖନ୍ତୁ</span>
                    </div>
                    <span class="material-symbols-rounded" style="color:#aaa">chevron_right</span>
                </a>
            </div>
        </div>
    </div>

    <!-- 
      ================================================================
      VIEW 2: CARD UI (Shown if URL HAS parameters)
      This view contains the IDs expected by the JavaScript logic.
      ================================================================
    -->
    <div id="view-card" class="hidden">
        <div>
            <img id="main-image" src="https://imsbg.github.io/odiabhasa/images/app.png" alt="Content">
        </div>

        <h1 id="page-title">ଓଡ଼ିଆ ଭାଷା</h1>
        <p id="page-subtitle">ଆମ ଭାଷା, ଆମ ପରିଚୟ</p>

        <div id="loading-section">
            <div class="spinner"></div>
            <p id="status-text" style="font-size: 13px; color: #666; font-family: var(--font-odia);">ଆପ୍ ଖୋଲୁଅଛି...</p>
        </div>

        <div id="manual-actions" class="hidden" style="width:100%">
            <a id="store-link" href="#" class="action-btn btn-red">
                <span class="material-symbols-rounded">android</span>
                ଆପ୍ ଇନଷ୍ଟଲ୍ କରନ୍ତୁ
            </a>
            <a id="web-read-link" href="#" class="action-btn btn-white hidden">
                <span class="material-symbols-rounded">menu_book</span>
                ୱେବସାଇଟ୍ ରେ ପଢ଼ନ୍ତୁ
            </a>
        </div>

        <div class="footer">
            &copy; 2024 Odia Bhasa App. Privacy Policy
        </div>
    </div>

    <!-- 
      ================================================================
      JAVASCRIPT LOGIC
      ================================================================
    -->
    <script>
      (function() {
        // --- VIEW TOGGLE LOGIC (Added to switch UI based on URL) ---
        const viewHome = document.getElementById('view-home');
        const viewCard = document.getElementById('view-card');
        
        // If query parameters exist (length > 1 because '?' is 1), show Card UI. Else show Home UI.
        if (window.location.search.length > 1) {
            viewHome.classList.add('hidden');
            viewCard.classList.remove('hidden');
            document.body.classList.add('card-mode');
        } else {
            viewHome.classList.remove('hidden');
            viewCard.classList.add('hidden');
            document.body.classList.remove('card-mode');
            // Stop execution here for Home UI so we don't auto-redirect to app/store
            return; 
        }

        // --- ORIGINAL LOGIC BELOW (UNTOUCHED) ---
        const PLAY_STORE_URL = 'https://play.google.com/store/apps/details?id=in.sandeep.odiabhasa';
        const WEB_READER_BASE_URL = 'https://imsbg.github.io/odiabhasa/all-books?book='; 

        const titleMap = {
            "Swara": "ସ୍ଵରବର୍ଣ୍ଣ",
            "Byanjana": "ବ୍ୟଞ୍ଜନବର୍ଣ୍ଣ",
            "Sankhya": "୧ ରୁ ୧୦୦ ପର୍ଯ୍ୟନ୍ତ ସଂଖ୍ୟା",
            "Yukta": "ଯୁକ୍ତାକ୍ଷର",
            "Barna_Parichaya": "ବର୍ଣ୍ଣ ପରିଚୟ",
            "Matra": "ମାତ୍ରା",
            "Phala": "ଫଳା",
            "Bahi": "ଓଡ଼ିଆ ବହି",
            "Book_Reader": "ବହି ପଢିବା",
            "Menu": "ମେନୁ",
            "About": "ଆପ୍ ବିଷୟରେ",
            "History_Odisha": "ଓଡ଼ିଶାର ଇତିହାସ",
            "History_Lang": "ଓଡ଼ିଆ ଭାଷାର ଇତିହାସ",
            "Lipyantara": "ଲିପ୍ୟନ୍ତର",
            "Odia_Calendar": "ଓଡ଼ିଆ କ୍ୟାଲେଣ୍ଡର",
            "Madhu_Barnabodha": "ଛବିଳ ମଧୁ ବର୍ଣ୍ଣବୋଧ",
            "Writing": "ଓଡ଼ିଆ ଅକ୍ଷର ଲେଖି ଶିଖନ୍ତୁ"
        };

        const params = new URLSearchParams(window.location.search);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        const ui = {
            img: document.getElementById('main-image'),
            title: document.getElementById('page-title'),
            subtitle: document.getElementById('page-subtitle'),
            status: document.getElementById('status-text'),
            loader: document.getElementById('loading-section'),
            actions: document.getElementById('manual-actions'),
            webBtn: document.getElementById('web-read-link'),
            storeBtn: document.getElementById('store-link')
        };

        let contentId = null;

        if (params.has('Bahi')) {
            contentId = params.get('Bahi');
            const jsonUrl = `https://sbgb.pages.dev/ବହି/ଖାତା/${contentId}.json`;

            fetch(jsonUrl)
                .then(res => res.json())
                .then(data => {
                    ui.title.textContent = data.title;
                    ui.subtitle.textContent = "ଲେଖକ: " + data.author;
                    
                    if (data.coverpage) {
                        ui.img.src = data.coverpage;
                    }
                    document.title = data.title + " | ଓଡ଼ିଆ ଭାଷା";
                })
                .catch(err => {
                    console.error("Error fetching book:", err);
                    ui.title.textContent = "ଓଡ଼ିଆ ବହି";
                });
                
            ui.webBtn.href = WEB_READER_BASE_URL + contentId;

        } else {
            let key = window.location.search.substring(1).split('=')[0];
            if (titleMap[key]) {
                ui.title.textContent = titleMap[key];
                contentId = key;
            }
        }

        ui.storeBtn.href = PLAY_STORE_URL;
        const customSchemeUrl = 'odiabhasa://open' + window.location.search;

        if (isMobile) {
            window.location.href = customSchemeUrl;

            const fallbackTimeout = setTimeout(function() {
                ui.loader.classList.add('hidden'); 
                ui.actions.classList.remove('hidden'); 
                window.location.href = PLAY_STORE_URL;
            }, 2500);

            function onVisibilityChange() {
                if (document.hidden || document.webkitHidden) {
                    clearTimeout(fallbackTimeout);
                }
            }
            document.addEventListener('visibilitychange', onVisibilityChange, false);
            window.addEventListener('pagehide', () => clearTimeout(fallbackTimeout), false);

        } else {
            ui.status.textContent = "ଓଡ଼ିଆ ଭାଷା ଆପ୍ କୁ ସ୍ୱାଗତ";
            ui.loader.classList.add('hidden');
            ui.actions.classList.remove('hidden');
            
            if (params.has('Bahi')) {
                ui.webBtn.classList.remove('hidden');
            } else {
                ui.webBtn.classList.add('hidden'); 
            }
        }
      })();
    </script>
</body>
</html>
